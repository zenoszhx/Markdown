---
title: 1.4 内存管理总结
categories: Cocos2d-C++
---

Cocos2d-x内存管理使用注意事项如下：

（1） Ref的引用计数并不是线程安全的。在多线程中，我们需要通过处理互斥锁来保证线程安全。在Objective-C中，由于AutoreleasePool是是语言级别的系统实现，所以每个线程都有自己的AutoreleasePool队列。在Cocos2d-x中，从性能等方面考虑，没有提供线程的安全实现。

（2）对自定义Node的子类，为该类添加create()方法，并使该方法返回一个autorelease对象。

（3）对自定义的数据类型，如果需要动态分配内存，继承自Ref，使用智能指针RefPtr来管理其内存的释放。

（4）对只在一个方法内部使用的Ref对象，需要使用自动回发池的，应该使用自定义的AutoreleasePool来即时清理对内存的占用。

（5）不要动态分配AutoreleasePool对象，要始终使用自动变量。

（6）不要显式地调用RefPtr的构造函数，始终使用隐式方式调用构造函数，因为显式的构造函数会导致同时执行构造函数各赋值操作符，这会造成一次不必要的临时智能指针变量的产生。

