---
title: 游戏优化
category: 游戏开发
tags: 
    - H5游戏
    - 游戏优化
---

### 1 UI资源优化

##### 1.1 资源优化

1 任何一个UI图集最大1024 * 1024；

2 同一个界面的图集尽量放到同一个图集，重复利用的公用资源放到common；

3 能用九宫格尽量用9宫格来减少原图大小；

4 美术给过来的UI原图size尽量小，对于一些全屏loading原画图，可以按比例缩小；

5 对于特别长的原图，可以分开合图再拼接；

6 图集利用率低于1/3，重新合图；

### 2 GPU优化

##### 1 Shader优化

1 简化shader代码，把单独的效果拎出来；

2 关闭雾化和粒子；

##### 2 OverDraw优化

1 移动设备上，OverDraw的压力主要来自半透明物体，因为多数情况下半透明物体需要开启Alpha Blend且关闭ZWrite，同时我们绘制像alpha = 0这种实际上不会产生效果的颜色上去，也同样有Blend操作，这是一种极大的浪费。

如果UI绘制是Alpha Blend且关闭ZWrite，因此UI OverDraw优化在制作界面的时候减少UI重叠层。

2 其他可控制的优化点：

- 如果去掉fillcenter不影响最后出来的效果就要把fillenter去掉；
- 看不见的UI且没有逻辑功能要disable或者挪出裁剪区域，而不是要通过设置Alpha=0来隐藏；
- 不要使用一张Alpha = 0 的图片来实现放大响应区域的功能；
- UI底层系统来控制隐藏看不见的元素，例如打开全屏UI的时候把下面看不见的UI挪出裁剪区域，关闭主相机渲染；

### 3 CPU优化 

##### 3.1 DrawCall优化

引擎本身会尽量帮我们去优化合并，我们要做的就是弄清楚它的合批机制，然后让UI元素尽量合批绘制。下面是一些优化tips：

- 使用图集；
- 相邻节目尽量使用同一个图集的图片；
- 尽量避免字体穿插，因为Text本身也是使用的FontTexture
- 减少使用Mask组件，Mask实现的原理是Stencil Buffer，往模板缓存里绘制，模板缓存里的东西才是可见的，模板会打断所有的合批。

##### 3.2 尽量减少刷新顶点的次数

CPU飙高胡主要原因是重新生成的顶点数据，刷新顶点数据的消耗和当前Graphic的顶点数正相关，对于UI来说，顶点数主要是由Image控件和Text控件产生。对于Image，顶点的数量主要取决于ImageType:

1 simple模式只有4个；
2 seliced有36个，如果没勾选fillcenter顶点数是32个；
3 tiled模式，平铺模式，铺开了N张图就有4*N个顶点；
4 Filled模式，用来做进度条，不少于4个。

Txet在不加任何效果的情况下，一个字符串是4个顶点，单独加shadow后一个字符串顶点是8个，单独加outline之后一个字符串胡定点数是20个。shadow和outline都加是40个。如果界面上;

还有一些像素对其相关的调整。

##### 3.3 

### 4 其他UI优化建议

1 精简拆分界面资源，动态加载。

渲染顺序和节点布局相关，降低学习成本。如果依赖depth来设置渲染顺序，对于复杂的UI界面来说后期维护起来会很麻烦。

2 对于存在非常多元素的界面，避免一次全部创建，分帧加载。

3 节点重用，避免频繁创建销毁同一个UI子元素，使用对象池维护。

4 UI节点不会动态调整的情况少用Layout组件。

5 不要重复设置active，这样会重新生成定点数据。



